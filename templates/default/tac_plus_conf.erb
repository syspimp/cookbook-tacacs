# Generated by Chef.
# Local modifications will be overwritten.

accounting file = <%= node['tacacs']['acct_log_path'] %>

<% if node['tacacs']['tac_key'] -%>
key = <%= node['tacacs']['tac_key'] %>
<% end -%>

<% ! @admins.empty? && @admins.each do |admin| -%>
user = <%= admin %> {
    member = admin
}
<% end -%>

<% ! @viewers.empty? && @viewers.each do |viewer| -%>
  <%- if node['tacacs']['robot']['username'] && viewer != node['tacacs']['robot']['username'] -%>
user = <%= viewer %> {
    member = viewonly
}
  <% end -%>
<% end -%>

<% if node['tacacs']['robot']['username'] -%>
user = <%= node['tacacs']['robot']['username'] %> {
    login = cleartext <%= @user_creds['password'] %>
    service = exec { priv-lvl = 10 }
    cmd = show { permit .* }
    cmd = copy { permit .* }
    cmd = enable { permit .* }
    cmd = routing-context { permit .* }
    cmd = bash { permit .* }
    cmd = sudo { permit .* }
    cmd = ip { permit .* }
    cmd = crontab { permit .* }
    cmd = grep { permit .* }
    cmd = which { permit .* }
    cmd = /mnt/flash/chef/chef-client { permit .* }
    cmd = /mnt/flash/chef/sysdb-root-wrapper { permit .* }
    cmd = echo { permit .* }
    cmd = terminal { permit .* }
    cmd = if { permit .* }
    cmd = mkdir { permit .* }
    cmd = chmod { permit .* }
    cmd = syncfiles.sh { permit .* }
    cmd = configure { permit .* }
    cmd = username { permit .* }
    cmd = cat { permit .* }
    cmd = wget { permit .* }
    cmd = rm { permit .* }
    cmd = cd { permit .* }
    cmd = sed { permit .* }
    cmd = tacacs-server { permit .* }
    cmd = aaa { permit .* }
    cmd = sflow { permit .* }
    cmd = snmp { permit .* }
    cmd = syslog { permit .* }
    cmd = ntp { permit .* }
    cmd = include { permit .* }
    cmd = event-handler { permit .* }
    cmd = no { permit .* }
    cmd = banner { permit .* }
    cmd = alias { permit .* }
    cmd = /mnt/flash/chef/fixvrf.sh { permit .* }
}
<% end -%>


group = admin {
    default service = permit
    login = PAM
    service = exec {
        priv-lvl = 15
    }
}

group = viewonly {
    default service = deny
    login = PAM
    service = exec { priv-lvl = 10 }
    cmd = show { permit .* }
    cmd = copy { permit .* }
    cmd = enable { permit .* }
    cmd = terminal { permit .* }
    cmd = routing-context { permit .* }
    cmd = bash { permit .* }
    cmd = ip { permit .* }
}
